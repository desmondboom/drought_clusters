# 热浪聚类分析工具集

本文件夹包含用于验证和调试热浪聚类分析结果的实用工具脚本。

## 工具列表

### 1. 数据调试工具

#### `debug_data.py` - 数据预处理调试

**功能**：调试第一步数据预处理的结果，检查热浪掩膜生成是否正确。

**使用方法**：

```bash
python utils/debug_data.py
```

**输出**：

- 数据基本信息（时间范围、数据形状等）
- 温度数据统计（实际温度 vs 阈值温度）
- 热浪掩膜统计（热浪格点数量和比例）
- 每日热浪情况统计
- 可视化图表（保存为 `debug_heatwave_data.png`）

**适用场景**：

- 验证数据预处理是否正确
- 检查热浪阈值计算是否合理
- 可视化温度分布和热浪掩膜

---

#### `debug_step2.py` - 第二步时间筛选调试

**功能**：调试第二步聚类识别中的时间筛选逻辑，确保正确提取 2011-2020 年 5-9 月的数据。

**使用方法**：

```bash
python utils/debug_step2.py
```

**输出**：

- 原始数据信息
- 目标时间范围
- 筛选结果统计
- 筛选后数据的热浪情况
- 前 10 天的热浪格点数量

**适用场景**：

- 验证时间筛选逻辑是否正确
- 检查筛选后的数据是否包含热浪
- 调试第二步的数据传递问题

---

### 2. 结果验证工具

#### `quick_check.py` - 快速检查

**功能**：快速检查 pck 文件的基本信息，提供简洁的统计报告。

**使用方法**：

```bash
python utils/quick_check.py
```

**输出**：

- 文件数量统计（Mask、Dictionary、Count 文件）
- 日期范围
- 样本文件的基本信息（形状、热浪格点数、聚类数等）

**适用场景**：

- 快速了解处理结果概况
- 初步检查是否有明显问题
- 日常监控处理进度

---

#### `verify_pck.py` - 详细验证

**功能**：对 pck 文件进行全面的正确性验证和质量检查。

**使用方法**：

```bash
python utils/verify_pck.py
```

**输出**：

- 文件完整性检查
- 样本文件详细分析
- 日期一致性检查
- 聚类质量统计（面积、强度分布等）

**适用场景**：

- 全面验证处理结果的正确性
- 检查数据质量和完整性
- 生成详细的分析报告

---

#### `visualize_clusters.py` - 可视化验证

**功能**：生成热浪聚类结果的可视化图表，直观展示分析结果。

**使用方法**：

```bash
python utils/visualize_clusters.py
```

**输出**：

- 热浪分布图（原始掩膜 vs 聚类结果）
- 聚类统计图表（时间序列、分布直方图等）
- 特定日期的详细检查

**适用场景**：

- 直观展示热浪聚类结果
- 检查聚类的空间分布特征
- 生成用于报告的可视化图表

---

## 使用流程建议

### 1. 数据预处理阶段

```bash
# 运行数据预处理
python src/01_data_preprocessing.py

# 验证预处理结果
python utils/debug_data.py
```

### 2. 聚类识别阶段

```bash
# 调试时间筛选逻辑
python utils/debug_step2.py

# 运行聚类识别
python src/02_calculate_drought_clusters_parallel.py

# 快速检查结果
python utils/quick_check.py
```

### 3. 结果验证阶段

```bash
# 详细验证结果
python utils/verify_pck.py

# 可视化展示
python utils/visualize_clusters.py
```

### 4. 事件追踪阶段

```bash
# 运行事件追踪
python src/03_process_drought_clusters.py

# 最终验证
python utils/verify_pck.py
```

## 输出文件说明

### 调试输出

- `debug_heatwave_data.png` - 数据预处理可视化结果
- 控制台输出 - 详细的统计信息和诊断结果

### 验证输出

- 控制台输出 - 文件统计、质量检查结果
- 可视化图表 - 热浪分布和聚类统计图

## 常见问题排查

### 1. 热浪格点数为 0

- 检查数据预处理是否正确
- 验证温度阈值计算是否合理
- 确认数据单位转换是否正确

### 2. 聚类数量为 0

- 检查最小面积阈值设置
- 验证热浪掩膜数据
- 确认聚类算法参数

### 3. 文件数量不匹配

- 检查时间筛选逻辑
- 验证日期范围设置
- 确认文件保存路径

### 4. 日期范围错误

- 检查时间轴处理
- 验证日期计算逻辑
- 确认时区设置

## 注意事项

1. **运行顺序**：建议按照上述流程顺序运行工具
2. **数据路径**：确保数据文件路径正确
3. **依赖环境**：需要安装 numpy、netCDF4、matplotlib 等依赖
4. **内存使用**：大数据集可能需要较多内存
5. **文件权限**：确保有读取数据文件和写入输出文件的权限

## 扩展功能

如需添加新的验证工具，建议：

1. 遵循现有的命名规范
2. 添加详细的文档说明
3. 包含错误处理机制
4. 提供清晰的输出格式
